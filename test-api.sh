#!/bin/bash

# –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ API –§–∞–∑—ã 2
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./test-api.sh

echo "üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API SiteBuilder - –§–∞–∑–∞ 2"
echo "=========================================="
echo ""

BASE_URL="http://localhost:3000"

echo "1Ô∏è‚É£  –¢–µ—Å—Ç: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
echo "POST /api/auth/register"
curl -s -X POST "${BASE_URL}/api/auth/register" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Test User",
    "email": "test@example.com",
    "password": "test123"
  }' | jq '.'
echo ""
echo ""

echo "2Ô∏è‚É£  –¢–µ—Å—Ç: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤ (–ø—É–±–ª–∏—á–Ω—ã–π endpoint)"
echo "GET /api/templates"
curl -s "${BASE_URL}/api/templates" | jq 'length'
echo " —à–∞–±–ª–æ–Ω–æ–≤ –Ω–∞–π–¥–µ–Ω–æ"
echo ""
echo ""

echo "üìù –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö endpoints:"
echo ""
echo "1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: npm run dev"
echo "2. –í–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä:"
echo "   - –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä: admin@example.com / admin123"
echo "   - –†–µ–¥–∞–∫—Ç–æ—Ä: editor@example.com / editor123"
echo "   - –ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å: viewer@example.com / viewer123"
echo ""
echo "3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä –∫–æ–Ω—Å–æ–ª—å:"
echo ""
echo "// –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ—Å—Ç–æ–≤"
echo "fetch('/api/posts', { credentials: 'include' })"
echo "  .then(r => r.json())"
echo "  .then(console.log)"
echo ""
echo "// –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø–æ—Å—Ç (ADMIN –∏–ª–∏ EDITOR)"
echo "fetch('/api/posts', {"
echo "  method: 'POST',"
echo "  headers: { 'Content-Type': 'application/json' },"
echo "  credentials: 'include',"
echo "  body: JSON.stringify({"
echo "    title: '–ù–æ–≤—ã–π –ø–æ—Å—Ç',"
echo "    slug: 'new-post',"
echo "    content: '–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–æ—Å—Ç–∞',"
echo "    published: true"
echo "  })"
echo "})"
echo "  .then(r => r.json())"
echo "  .then(console.log)"
echo ""
echo "// –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤"
echo "fetch('/api/media', { credentials: 'include' })"
echo "  .then(r => r.json())"
echo "  .then(console.log)"
echo ""
echo "// –ó–∞–≥—Ä—É–∑–∏—Ç—å –º–µ–¥–∏–∞—Ñ–∞–π–ª (ADMIN –∏–ª–∏ EDITOR)"
echo "fetch('/api/media', {"
echo "  method: 'POST',"
echo "  headers: { 'Content-Type': 'application/json' },"
echo "  credentials: 'include',"
echo "  body: JSON.stringify({"
echo "    name: '–¢–µ—Å—Ç–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ',"
echo "    fileName: 'test.jpg',"
echo "    url: 'https://via.placeholder.com/800x600',"
echo "    type: 'IMAGE',"
echo "    mimeType: 'image/jpeg',"
echo "    size: 100000,"
echo "    width: 800,"
echo "    height: 600,"
echo "    alt: '–¢–µ—Å—Ç–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ'"
echo "  })"
echo "})"
echo "  .then(r => r.json())"
echo "  .then(console.log)"
echo ""
echo "‚úÖ –î–æ—Å—Ç—É–ø–Ω—ã–µ API endpoints:"
echo ""
echo "–ü–æ—Å—Ç—ã:"
echo "  GET    /api/posts              - –°–ø–∏—Å–æ–∫ –ø–æ—Å—Ç–æ–≤"
echo "  POST   /api/posts              - –°–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç"
echo "  GET    /api/posts/:id          - –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å—Ç"
echo "  PUT    /api/posts/:id          - –û–±–Ω–æ–≤–∏—Ç—å –ø–æ—Å—Ç"
echo "  DELETE /api/posts/:id          - –£–¥–∞–ª–∏—Ç—å –ø–æ—Å—Ç"
echo ""
echo "–ú–µ–¥–∏–∞—Ñ–∞–π–ª—ã:"
echo "  GET    /api/media              - –°–ø–∏—Å–æ–∫ –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤"
echo "  POST   /api/media              - –ó–∞–≥—Ä—É–∑–∏—Ç—å –º–µ–¥–∏–∞—Ñ–∞–π–ª"
echo "  GET    /api/media/:id          - –ü–æ–ª—É—á–∏—Ç—å –º–µ–¥–∏–∞—Ñ–∞–π–ª"
echo "  PUT    /api/media/:id          - –û–±–Ω–æ–≤–∏—Ç—å –º–µ–¥–∏–∞—Ñ–∞–π–ª"
echo "  DELETE /api/media/:id          - –£–¥–∞–ª–∏—Ç—å –º–µ–¥–∏–∞—Ñ–∞–π–ª"
echo ""
echo "üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:"
echo "  - API.md - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API"
echo "  - openapi.yaml - OpenAPI —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è"
echo "  - PHASE2_IMPLEMENTATION.md - –û—Ç—á–µ—Ç –æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏"
echo ""
